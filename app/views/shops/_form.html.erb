<% semantic_form_for(@shop, :html => { :multipart => true }) do |f| %>
  <% f.inputs do %>
    <%= f.input :name %>
    <%= f.input :link, :hint => "http://shop.baze.dk/<em>#{@shop.link || 'link'}</em>" %>
    <%= f.input :logo %>
    <%= f.input :username_text %>
    <%= f.input :password_text, :as => :string %>
    <%= f.input :text %>
    <%= f.input :currency %>
    <%= f.input :color %>
    <%= f.input :closed %>
  <% end %>
  <% unless @shop.new_record? %>
    <% f.inputs do %>
      <li>
        <%= f.label :categories %>
        <ol id="categories_tree">
          <% @shop.categories.roots.all(:order => 'position').each do |root| %>
            <%= render :partial => 'categories/tree', :locals => { :category => root } %>
          <% end %>
        </ol>
      </li>
      <%= link_to_new('category', new_shop_category_path(@shop)) %>
    <% end %>
    <% f.inputs do %>
      <li>
        <%= f.label :addresses %>
        <ol id="addresses">
          <% @shop.addresses.all(:order => 'position').each do |address| %>
            <% content_tag_for(:li, address) do %>
              <span class="handle">[drag]</span>
              <%= link_to(address.text.gsub("\r\n", ', '), edit_shop_address_path(@shop, address)) %>
              (<%= link_to('delete', shop_address_path(@shop, address), :confirm => "Delete address\n#{address.text}?", :method => :delete) %>)
            <% end %>
          <% end %>
        </ol>
      </li>
    <% end %>
    <%= link_to_new('address', new_shop_address_path(@shop)) %>
  <% end %>
  <%= f.buttons %>
<% end %>
<%= sortable_element_reporting_target(
  'categories_tree', 'moved_category_id', :handle => 'handle', :tree => true,
  :url => sort_shop_categories_path(@shop)) %>
<%= sortable_element('addresses', :url => sort_shop_addresses_path(@shop)) %>
