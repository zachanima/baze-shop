<% title ['List', @shop ? nil : 'all', 'users', @shop ? "of #{@shop.name}" : nil].join(' ') %>
<%= link_to_new('user', @shop ? new_shop_user_path(@shop) : new_user_path) %>
<%= link_to('Import users', @shop ? import_shop_users_path(@shop) : import_users_path) %>

<% form_tag({ :action => :multiple }, :class => 'index') do %>
  <table>
    <thead>
      <tr>
        <th class="checkbox"><input class="checkbox" id="check_all" onclick="$$('form input.checkbox').each(function(box){box.checked=$('check_all').checked})" type="checkbox"></th>
        <th>Name</th>
        <th><%= @shop ? 'Department' : 'Shop'%></th>
        <th>Username</th>
        <th>Password</th>
        <th>Orders</th>
        <th>Budget</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr class="<%= cycle('odd', 'even') %>">
          <td class="checkbox"><%= check_box_tag('user_ids[]', user.id, false, :class => 'checkbox') %></td>
          <td class="name"><%= link_to([user.first_name, user.last_name].join(' '), edit_shop_user_path(user.shop, user)) %></td>
          <td><%= @shop ? user.department : [link_to(user.shop.name, shop_users_path(user.shop)), user.department.empty? ? nil : "(#{user.department})"].join(' ') %></td>
          <td><%= user.login %></td>
          <td><%= user.password %></td>
          <td><%= user.order_groups.empty? ? nil : user.order_groups.count %></td>
          <td><%= format_currency(user.budget) %></td>
          <td><%= format_currency(user.balance) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
